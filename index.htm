<!DOCTYPE html>
<html>
	<head>
		<script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script> 
		<script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/suncalc/1.8.0/suncalc.min.js"></script>
		
	</head>
	<body style="margin: 0;">
		<script>
			currentdate = new Date();
			
			userLocation = getLocation();

			function getLocation() {
				if (navigator.geolocation) {
					navigator.geolocation.getCurrentPosition(showPosition);
				} else { 
					console.log("Geolocation is not supported by this browser.");
				}
			}

			function showPosition(position) {
				console.log(position);
				LogSunPosition = SunCalc.getPosition(currentdate, position.coords.latitude, position.coords.longitude);
				console.log("Altitude: " + LogSunPosition.altitude + " Azimuth: " + LogSunPosition.azimuth);
				
				AFRAME.registerComponent('sun-position', {
					console.log("sun-position component registration started");
					init: function () {
						console.log("New Update - every 5 sec");
						// Update the position of the sphere every 5 seconds
						setInterval(() => {
						// Get the current position of the sun
						const { altitude, azimuth } = SunCalc.getPosition(currentdate, position.coords.latitude, position.coords.longitude);

						// Calculate the position of the sphere based on the sun's position
						const position = this.calculatePosition(altitude, azimuth);

						// Update the position of the sphere
						console.log("New Position: "+position);
						this.el.setAttribute('position', position);
						}, 5000);
					},

					calculatePosition: function (altitude, azimuth) {
					// Convert altitude and azimuth to X, Y, Z coordinates
					const x = Math.sin(azimuth) * Math.cos(altitude) * this.data.distance;
					const y = Math.sin(altitude) * this.data.distance;
					const z = Math.cos(azimuth) * Math.cos(altitude) * this.data.distance;
					
						console.log("New Calculation: "+ x +" "+ y +" "+ z)
						
					return { x, y, z };
					}
				});


			}
		</script>
		<a-scene>
			<a-entity camera></a-entity>
			<a-sphere id="sun" radius="0.5" color="yellow" opacity="0.5" sun-position></a-sphere>
			<a-entity position="0 0 -3">
				<a-box color="red" width="1" height="1" depth="1"></a-box>
			</a-entity>
		</a-scene>

	</body>
</html>
