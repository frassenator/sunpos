<!DOCTYPE html>
<html>
  <head>
    <title>SunPos</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/suncalc/1.8.0/suncalc.min.js"></script>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
  </head>
  <body>
    <h1>SunPos 0.7</h1>
	<a-scene embedded arjs>
      		<a-entity camera></a-entity>
      		<a-sphere position="0 0 0" radius="0.5" color="red" id="sun-object" sun-object-position></a-sphere>
      		<a-cone position="0 1 0" radius-bottom="0.1" height="0.2" color="blue" look-at="#sun-object"></a-cone>
    	</a-scene>

    <script>
      AFRAME.registerComponent('sun-object-position', {
        dependencies: ['position'],
        schema: {
          objHeight: {type: 'number', default: 1},
          objWidth: {type: 'number', default: 1}
        },
        update: function () {
          var sunPos = SunCalc.getPosition(new Date(), this.el.getAttribute('position').x, this.el.getAttribute('position').y);
          var elevation = sunPos.altitude * 180 / Math.PI;
          var azimuth = sunPos.azimuth * 180 / Math.PI;
          var distance = sunPos.distance;
          var radius = Math.tan(this.el.sceneEl.camera.fov / 2 * Math.PI / 180) * distance;
          var scale = radius * this.data.objWidth * 2;

          this.el.setAttribute('rotation', {x: -elevation, y: azimuth, z: 0});
          this.el.setAttribute('scale', {x: scale, y: scale * this.data.objHeight, z: scale});

          var arrow = document.querySelector('a-cone');
          if (arrow) {
            arrow.setAttribute('visible', true);
          }
        }
      });
    </script>
  </body>
</html>
