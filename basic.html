<!DOCTYPE html>
<html>
	<head>
		<script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
		<!-- <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script> -->
    		<script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
		
		<script>
			function getNewCoordinate(latitude, longitude, distance, direction) {
				console.log("getNewCoordinate Function initiated");
			  const radius = 6371000; // Earth's radius in meters
			  const lat1 = latitude * Math.PI / 180; // Convert latitude to radians
			  const lon1 = longitude * Math.PI / 180; // Convert longitude to radians
			  const bearing = getBearing(direction); // Calculate bearing in radians

			  const lat2 = Math.asin(Math.sin(lat1) * Math.cos(distance / radius) +
						  Math.cos(lat1) * Math.sin(distance / radius) * Math.cos(bearing));
			  const lon2 = lon1 + Math.atan2(Math.sin(bearing) * Math.sin(distance / radius) * Math.cos(lat1),
							 Math.cos(distance / radius) - Math.sin(lat1) * Math.sin(lat2));

			  // Convert new latitude and longitude back to degrees
			  const newLatitude = lat2 * 180 / Math.PI;
				console.log("New Latitude calculated: "+newLatitude);
			  const newLongitude = lon2 * 180 / Math.PI;
				console.log("New Longitude calculated: "+newLongitude);

			  return { latitude: newLatitude, longitude: newLongitude };
			}

			function getBearing(direction) {
			  switch (direction) {
			    case "north":
			      return 0;
			    case "south":
			      return Math.PI;
			    case "east":
			      return Math.PI / 2;
			    case "west":
			      return 3 * Math.PI / 2;
			    default:
			      throw new Error("Invalid direction: ${direction}");
			  }
			}

			navigator.geolocation.getCurrentPosition(position => {
				
				// Get the latitude and longitude of current location
				var latitude = position.coords.latitude;
				var longitude = position.coords.longitude;

				// Give Current Position box the current lat and long
				var currentPos = document.querySelector("#current-position");
				currentPos.setAttribute("gps-new-entity-place", {
					latitude: latitude,
					longitude: longitude
				});
				
				// Give North Position box the current lat and long
				var northPos = document.querySelector("#north-position");
				var { northLatitude, northLongitude } = getNewCoordinate(latitude, longitude, 50, "north");
				northPos.setAttribute("gps-new-entity-place", {
					latitude: northLatitude,
					longitude: northLongitude
				});
				
				// Give South Position box the current lat and long
				var southPos = document.querySelector("#south-position");
				var { southLatitude, southLongitude } = getNewCoordinate(latitude, longitude, 50, "south");
				southPos.setAttribute("gps-new-entity-place", {
					latitude: southLatitude,
					longitude: southLongitude
				});
				
				// Give East Position box the current lat and long
				var eastPos = document.querySelector("#east-position");
				var { eastLatitude, eastLongitude } = getNewCoordinate(latitude, longitude, 50, "east");
				eastPos.setAttribute("gps-new-entity-place", {
					latitude: eastLatitude,
					longitude: eastLongitude
				});
				
				// Give West Position box the current lat and long
				var westPos = document.querySelector("#west-position");
				var { westLatitude, westLongitude } = getNewCoordinate(latitude, longitude, 50, "west");
				westPos.setAttribute("gps-new-entity-place", {
					latitude: westLatitude,
					longitude: westLongitude
				});
			});
		</script>
		
	</head>
	<body style="margin: 0;">
		<a-scene vr-mode-ui="enabled: false" arjs="sourceType: webcam; videoTexture: true; debugUIEnabled: false" renderer="antialias: true; alpha: true" inspector="url: https://cdn.jsdelivr.net/gh/aframevr/aframe-inspector@master/dist/aframe-inspector.min.js">
			<a-camera gps-new-camera="gpsMinDistance: 20"></a-camera>
			<a-box id="current-position" scale="1 1 1" color="grey"></a-box>
			<a-box id="north-position" scale="1 1 1" color="blue"></a-box>
			<a-box id="south-position" scale="1 1 1" color="red"></a-box>
			<a-box id="east-position" scale="1 1 1" color="green"></a-box>
			<a-box id="west-position" scale="1 1 1" color="yellow"></a-box>
		</a-scene>
	</body>
</html>
