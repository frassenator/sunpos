<!DOCTYPE html>
<html>
	<head>
		<!-- A-Frame itself -->
		<script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>

		<!-- Pure three.js code that the A-Frame components use for location-based AR -->
		<script type='text/javascript' src='https://raw.githack.com/AR-js-org/AR.js/master/three.js/build/ar-threex-location-only.js'></script>

		<!-- AR.js A-Frame components -->
		<script type='text/javascript' src='https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js'></script>
		
		<!-- Axis Helper -->
		<script src="js/aframe-axes-helper-component.js"></script>
		
		<!-- Compass.js -->
		<script src="js/compass.js"></script>
		
		<script src="https://cdnjs.cloudflare.com/ajax/libs/suncalc/1.8.0/suncalc.min.js"></script>
		

		
		<script>
			
		Compass.watch(function (heading) {
			console.log("Heading: "+heading);
			alert("Heading: "+heading);
			//$('.degrees').text(heading);
			//$('.compass').css('transform', 'rotate(' + (-heading) + 'deg)');
		});
		
		// Get device orientation event data
		/*
		function deviceOrientationListener(event) {  
		  var alpha    = event.alpha; //z axis rotation \[0,360)  
		  var beta     = event.beta; //x axis rotation \[-180, 180\]  
		  var gamma    = event.gamma; //y axis rotation \[-90, 90\]

		  //Check if absolute values have been sent  
		  if (typeof event.webkitCompassHeading !== "undefined") {  
		    alpha = event.webkitCompassHeading; //iOS non-standard
		  }
		  else {  
		    console.log("Your device is reporting relative alpha values, so this compass won't point north");  
		  }
		  
		  alert("Alpha: " + alpha);
		}  

		// Check if device can provide absolute orientation data  
		if (window.DeviceOrientationAbsoluteEvent) {  
		  window.addEventListener("DeviceOrientationAbsoluteEvent", deviceOrientationListener); 
		} // If not, check if the device sends any orientation data  
		else if(window.DeviceOrientationEvent){  
		  window.addEventListener("deviceorientation", deviceOrientationListener);
		  
		}
		else {  
		  console.log("Sorry, try again on a compatible mobile device!");  
		}  
		

		navigator.geolocation.getCurrentPosition(position => {
			// Get the current date and time
			//var now = new Date();
			var now = new Date("2022-07-07 10:00");

			// Get the latitude and longitude of your current location (e.g., using the Geolocation API)
			var latitude = position.coords.latitude;
			var longitude = position.coords.longitude;
			
			// Give Anchor box the current lat and long
			var anchorBox = document.querySelector("#anchor");
			anchorBox.setAttribute('gps-new-entity-place', {
				latitude: latitude,
				longitude: longitude
			});
			
			// Calculate the Sun's current position
			var sunPosition = SunCalc.getPosition(now, latitude, longitude);
			
			// Calculate the altitude offset from the horizon
  			var horizonOffset = -(sunPosition.altitude - 0.5 * Math.PI);

			// Distance from earth to sun in kilometers (adjusted for scaling)
			var kmDistance = 150;
			
			// Calculate the X, Y, and Z positions of the sun relative to the camera in kilometers. Includes horizon offset
			var x = Math.cos(horizonOffset) * Math.sin(sunPosition.azimuth) * kmDistance;
			var y = Math.cos(horizonOffset) * Math.cos(sunPosition.azimuth) * kmDistance;
			var z = Math.sin(horizonOffset) * kmDistance;
			
			// Set the position of the sphere
			var sunBox = document.querySelector("#sun");
			sunBox.setAttribute('position', { x, y, z });
		
		});*/
		</script>
		
	</head>
	<body style="margin: 0;">
		<a-scene debug vr-mode-ui="enabled: false" arjs="sourceType: webcam; videoTexture: true; debugUIEnabled: true">
			<a-camera gps-new-camera="gpsMinDistance: 20" rotation-reader></a-camera>
			<a-entity axes-helper></a-entity>
			<!-- <a-box id="anchor" color="blue" scale="1 1 1">
				<a-box id="sun" color="yellow" scale="20 20 20"></a-box>
			</a-box> -->
		</a-scene>
	</body>
</html>
