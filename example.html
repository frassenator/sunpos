<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/suncalc/1.8.0/suncalc.min.js"></script>
  </head>
  <body>
    <h1>V 0.4</h1>
    <a-scene embedded arjs>
        <a-entity
          id="sun"
          geometry="primitive: sphere; radius: 0.2"
          material="color: red; shader: flat"
          position="0 0 0"
        ></a-entity>
        <a-text
          id="sun-label"
          value="Sun"
          align="center"
          color="#ffffff"
          position="0 0.4 0"
          scale="0.5 0.5 0.5"
        ></a-text>
      </a-nft>
    </a-scene>
    <script>
      function calculateSunPosition() {
        // Return a Promise that resolves with the sun position and size, or rejects with an error
        return new Promise(function(resolve, reject) {
          navigator.geolocation.getCurrentPosition(
            function(position) {
              // Calculate the position and size of the sun
              var times = SunCalc.getTimes(new Date(), position.coords.latitude, position.coords.longitude);
              var sunPosition = SunCalc.getPosition(times.sunset, position.coords.latitude, position.coords.longitude);
              var altitude = sunPosition.altitude;
              var size = Math.tan(Math.PI/2 - altitude) * 3 * 100;
              // Convert the sun's position from spherical coordinates to Cartesian coordinates
              var x = Math.cos(sunPosition.azimuth) * Math.sin(altitude);
              var y = Math.sin(sunPosition.azimuth) * Math.sin(altitude);
              var z = Math.cos(altitude);
              resolve({ x: x * 3, y: y * 3, z: z * 3, size: size });
            },
            function(error) {
              reject(error);
            }
          );
        });
      }

      var sun = document.querySelector("#sun");

      function updateSunPosition() {
        calculateSunPosition()
          .then(function(position) {
            sun.setAttribute("position", position.x + " " + position.y + " " + position.z);
            sun.setAttribute("geometry", "primitive: sphere; radius: " + position.size/100);
            console.log("Sun position:", position);
          })
          .catch(function(error) {
            console.error("Error getting sun position:", error);
          });
      }

      // Update the position of the sun every 100 seconds
      setInterval(updateSunPosition, 100000);
    </script>
  </body>
</html>
