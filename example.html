<!DOCTYPE html>
<html>
  <head>
	<meta charset="utf-8">
    <title>AR Sun</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/suncalc/1.8.0/suncalc.min.js"></script>
	 <style>
      #ui-panel {
        position: absolute;
        bottom: 0;
        width: 100%;
        text-align: center;
        background-color: rgba(0, 0, 0, 0.8);
        color: red;
        font-size: 24px;
        padding: 8px;
        box-sizing: border-box;
      }
    </style>
   <body style='margin : 0px; overflow: hidden;'>
    <a-scene embedded arjs='sourceType: webcam; debugUIEnabled: false;' vr-mode-ui="enabled: false">
	
		<!-- Create a marker to detect where the user is looking -->
		<a-marker preset="hiro"></a-marker>
	
        <!-- Add a 3D sphere to represent the sun -->
        <a-sphere color="#FF0000" radius="1" position="0 0 -100" id="sun"></a-sphere>

        <!-- Add text elements for position and date information -->
        <a-plane id="ui-panel" height="2" width="4" position="0 1 -5">
        <a-text value="User position: " position="-1 0.4 0" align="center"></a-text>
        <a-text id="user-position" value="" position="-1 -0.1 0" align="center"></a-text>
        <a-text value="Sun position: " position="1 0.4 0" align="center"></a-text>
        <a-text id="sun-position" value="" position="1 -0.1 0" align="center"></a-text>
        <a-text id="date" value="" position="0 -0.7 0" align="center"></a-text>
      </a-plane>

        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // Get references to UI text elements
        var userPosition = document.querySelector('#user-position');
        var sunPosition = document.querySelector('#sun-position');
        var dateText = document.querySelector('#date');

        // Get user's current location
        function getUserLocation() {
            return new Promise((resolve, reject) => {
                navigator.geolocation.getCurrentPosition(resolve, reject);
            });
        }

        // Update the position of the sun based on user location and time
        function updateSunPosition(lat, long) {
            try {
                // Calculate sun's position
                var date = new Date();
                var sunPos = SunCalc.getPosition(date, lat, long);

                // Update sun position in 3D space
                var sphere = document.querySelector('#sun');
                var distance = 1000;
                var position = `${-sunPos.azimuth * distance} 0 ${-sunPos.altitude * distance}`;
                var size = 100 * (1 / Math.tan(sunPos.altitude + (Math.PI / 180)));
                sphere.setAttribute('position', position);
                sphere.setAttribute('scale', `${size} ${size} ${size}`);

                // Update UI with positions and date
                userPosition.setAttribute('text', `value: User position: ${lat.toFixed(4)}, ${long.toFixed(4)}`);
                sunPosition.setAttribute('text', `value: Sun position: ${position}`);
                dateText.setAttribute('text', `value: Date: ${date}`);
            } catch (err) {
                console.error(err);
            }
        }

        // Update sun position every 30 seconds
        setInterval(() => {
            getUserLocation().then(pos => {
                updateSunPosition(pos.coords.latitude, pos.coords.longitude);
            }).catch(err => {
                console.error(err);
            });
        }, 30000);
    </script>
</body>
</html>
