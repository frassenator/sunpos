<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/suncalc/1.8.0/suncalc.min.js"></script>
    <script>
      function getLocation() {
        return new Promise((resolve, reject) => {
          navigator.geolocation.getCurrentPosition(resolve, reject);
        });
      }

      function handleError(error) {
        var errorDiv = document.createElement('div');
        errorDiv.innerText = error.message;
        document.body.appendChild(errorDiv);
      }

      async function init() {
        try {
          const { coords } = await getLocation();
          const { latitude: lat, longitude: long } = coords;

          const sunPosition = SunCalc.getPosition(new Date(), lat, long);
          const altitude = sunPosition.altitude;
          const azimuth = sunPosition.azimuth;

          // Calculate the position of the sun based on altitude and azimuth
          const theta = azimuth - Math.PI / 2;
          const phi = Math.PI / 2 - altitude;
          const x = 100 * Math.sin(phi) * Math.cos(theta);
          const y = 100 * Math.cos(phi);
          const z = 100 * Math.sin(phi) * Math.sin(theta);

          // Calculate the size of the sun based on altitude
          const sunSize = 3 * (1000 / Math.tan(altitude + (Math.PI / 180) * 0.53));

          // Create the sun entity
          const scene = document.querySelector('a-scene');
          const sun = document.createElement('a-sphere');
          sun.setAttribute('position', `${x} ${y} ${z}`);
          sun.setAttribute('radius', sunSize);
          sun.setAttribute('color', 'red');
          scene.appendChild(sun);

          // Update UI with positions and date
          var userPosition = document.querySelector('[text*="User position"]');
          userPosition.setAttribute('value', `User position: ${lat.toFixed(4)}, ${long.toFixed(4)}`);
          var sunPositionEl = document.querySelector('[text*="Sun position"]');
          sunPositionEl.setAttribute('value', `Sun position: ${x.toFixed(2)}, ${y.toFixed(2)}, ${z.toFixed(2)}`);
          var dateEl = document.querySelector('[text*="Date"]');
          dateEl.setAttribute('value', `Date: ${new Date().toLocaleString()}`);

        } catch (error) {
          handleError(error);
        }
      }
    </script>
  </head>
  <body>
    <a-scene>
      <!-- Camera -->
      <a-entity camera look-controls position="0 1.6 0">
        <!-- User position -->
        <a-entity
          position="-0.5 -0.5 -1"
          text="value: User position: 0, 0"
          scale="0.5 0.5 0.5"
        ></a-entity>

        <!-- Sun position -->
        <a-entity
          position="0 -0.5 -1"
          text="value: Sun position: 0, 0, 0"
          scale="0.5 0.5 0.5"
        ></a-entity>

        <!-- Date and time -->
        <a-entity
          position="0.5 -0.5 -1"
          text="value: Date and time: "
          scale="0.5 0.5 0.5"
        ></a-entity>
      </a-entity>

      <!-- Sun -->
      <a-sphere
        position="0 0 0"
        radius="0.01"
        material="color: red"
        id="sun"
      ></a-sphere>
    </a-scene>
  </body>
  <script>
    init();
  </script>
</html>

